#!/bin/sh

if [[ -z "$1" ]] ; then (

  echo "Usage: ./makeJar <page name>"
  false

); else (

  export GAMEDATA=~/java/classes/org/sc3d/apt/crazon/gamedata/
  rm -r $GAMEDATA
  mkdir $GAMEDATA

  java org.sc3d.apt.crazon.compiler.Flattener ../wiki/ $1 >$GAMEDATA/asm.nfk

  echo "#Generated by compiler/makeJar, do not edit.
name: $1
width: 256
height: 256
msPerFrame: 25
" > $GAMEDATA/properties.txt

  ls -1 ../wiki/$1/res/ | sed s/^/$1_/ > $GAMEDATA/resources.txt
  for x in ../wiki/$1/res/*; do cp $x $GAMEDATA/$1_`basename $x`; done
  
  echo "JarIndex-Version: 1.0

crazon.jar
org/sc3d/apt/crazon/vm
org/sc3d/apt/crazon/vm/util
org/sc3d/apt/crazon/vm/state
org/sc3d/apt/crazon/vm/op
org/sc3d/apt/crazon/vm/platform

$1.jar
org/sc3d/apt/crazon/gamedata
" > META-INF/INDEX.LIST

  jar cvfm ../jars/$1.jar META-INF/MANIFEST.MF META-INF/INDEX.LIST -C ~/java/classes org/sc3d/apt/crazon/gamedata/

  chmod a+x ../jars/$1.jar

); fi
